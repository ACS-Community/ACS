#! /bin/bash
#*******************************************************************************
# cdbChecker
#
# "@(#) $Id: cdbChecker,v 1.5 2006/06/01 01:07:09 sharring Exp $"
#

#************************************************************************
#   NAME
#   cdbChecker - checks CDB structures and files.
# 
#   SYNOPSIS
#   cdbChecker [-v] [path to CDB XML files] [path to CDB XSD files] 
# 
#   DESCRIPTION
#   This script runs the cdbChecker application written in Java.
#   Pass to it the path where the CDB files are going to be found.
#
#   All xml files recursively found in [path to CDB XML files]
#   are checked. The optional argument contains a ":" separated list
#   of files and directories with absolute path.
#
#   Normally this command line argument points to the root 
#   directory of the CDB to be checked, i.e. it
#   is:
#         $ACS_CDB/CDB
#
#   All xsd files are recursively found in [path to CDB XSD files]
#   are checked in addition to the standard search path
#   automatically build and passed in the ACS.cdbPath property.
#   The optional argument contains a ":" separated list
#   of files and directories with absolute path.
#
#   The script generates the search path for the schema files
#   using the usual algorithms and puts the result in the
#   ACS.cdbPath propery before calling Java virtual machine.
#
#   The -v (verbose) option provides details about the checking 
#   process
#
#   FILES
#
#   ENVIRONMENT
#   ACS_CDB : Normally ACS_CDB is set to the
#             CDB being checked.
#             If this variable is set, schema files are always
#             searched also in $ACS_CDB/CDB/schemas
#
#   RETURN VALUES
#     0 - Everything fine
#     # - Errors encountered
#
#   CAUTIONS
#
#   EXAMPLES
#
#   SEE ALSO
#   Check the documentation of the cdbChecker Java implementation 
#   classes for specific additional parameters of the Java program,
#   not used or usable throught this script.
#
#   BUGS     
#
#------------------------------------------------------------------------
#

#
# Build the schema files search path
#
SUB=config/CDB/schemas

# Starts with ACSROOT.
SCHEMA_PATH=$ACSROOT/$SUB

# Separation of dirs
# from INTLIST.
item_list=`echo $INTLIST | sed s/:/\ /g`
intlist_list=""
for item in $item_list
do
   intlist_list=$intlist_list":$item/$SUB"
done

# If the intlist is empty
# there is nothing to add!
if [ "X$intlist_list" != "X" ]; then
   # INTLIST search path.
   SCHEMA_PATH=$intlist_list:$ACSROOT/$SUB
fi

# configure tmp path
if [ "X$ACSDATA" != "X" ]; then  
   TMP_PATH=$ACSDATA/tmp
else
   TMP_PATH="/tmp"
fi

# INTROOT path, if exists.
if [ "X$INTROOT" != "X" ]; then  
   SCHEMA_PATH=$INTROOT/$SUB:$SCHEMA_PATH
fi

# If a CDB is specified (and normally it is)
# searches also inside it (but normally it is empty)
if [ "X$ACS_CDB" != "X" ]; then  
   SCHEMA_PATH=$ACS_CDB/CDB/schemas:$SCHEMA_PATH
fi

# Finally adds the current module.
SCHEMA_PATH=$PWD/../$SUB:$SCHEMA_PATH
echo Searching for schema files in: $SCHEMA_PATH

config_path=$(searchFile config/reqSchemas.xml)
if [ "$config_path" != "#error#" ]
then
   acsStartJava --noDirectory -endorsed -DACS.tmp=$TMP_PATH -DACS.config_path=$config_path -DACS.cdbpath=$SCHEMA_PATH cl.utfsm.cdbChecker.CDBChecker $1 $2 $3 $4 $5 $6 $7 $8 $9 
   returnCode=$?
else
   echo "[Error] The configuration files are missing... Do a 'make install'"	   
   returnCode=1
fi					     

# Final return code
exit $returnCode

#
# ___oOo___

