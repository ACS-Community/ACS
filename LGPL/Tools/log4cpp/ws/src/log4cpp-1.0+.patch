diff -Naur log4cpp-1.0/configure log4cpp-1.0+/configure
--- log4cpp-1.0/configure	2007-08-29 09:33:57.000000000 +0000
+++ log4cpp-1.0+/configure	2011-02-11 17:14:34.248520000 +0000
@@ -21253,7 +21253,17 @@
 ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
-acx_pthread_ok=no
+if test "$cross_compiling" = no; then
+	acx_pthread_ok=no
+else
+	acx_pthread_ok=yes
+    { echo "$as_me:$LINENO: WARNING: On cross compiling without remote execution, the pthreads capability probe application
+    	cannot be executed. For now fake success of HAVE_PTHREAD, HAVE_THREADING, USE_PTHREADS
+    	and assume no pthreads specific PTHREAD_LIBS and PTHREAD_CFLAGS" >&5
+    echo "$as_me: WARNING: On cross compiling without remote execution, the pthreads capability probe application
+    	cannot be executed. For now fake success of HAVE_PTHREAD, HAVE_THREADING, USE_PTHREADS
+    	and assume no pthreads specific PTHREAD_LIBS and PTHREAD_CFLAGS" >&2;}
+fi	
 
 # We used to check for pthread.h first, but this fails if pthread.h
 # requires special compiler flags (e.g. on True64 or Sequent).
diff -Naur log4cpp-1.0/doc/Doxyfile.in log4cpp-1.0+/doc/Doxyfile.in
--- log4cpp-1.0/doc/Doxyfile.in	2007-09-03 09:53:14.000000000 +0000
+++ log4cpp-1.0+/doc/Doxyfile.in	2011-02-11 17:14:06.892821000 +0000
@@ -62,7 +62,9 @@
 INCLUDE_GRAPH        = YES
 INCLUDED_BY_GRAPH    = YES
 GRAPHICAL_HIERARCHY  = YES
-MAX_DOT_GRAPH_WIDTH    = 1024
-MAX_DOT_GRAPH_HEIGHT   = 1024
+#Warning: Tag `MAX_DOT_GRAPH_xxx' at line 65 of file Doxyfile has become obsolete.
+#To avoid this warning please update your configuration file using "doxygen -u"
+#MAX_DOT_GRAPH_WIDTH    = 1024
+#MAX_DOT_GRAPH_HEIGHT   = 1024
 GENERATE_LEGEND        = YES
 DOT_IMAGE_FORMAT = gif
diff -Naur log4cpp-1.0/include/log4cpp/config-vxworks.h log4cpp-1.0+/include/log4cpp/config-vxworks.h
--- log4cpp-1.0/include/log4cpp/config-vxworks.h	1970-01-01 00:00:00.000000000 +0000
+++ log4cpp-1.0+/include/log4cpp/config-vxworks.h	2011-02-11 17:14:06.906842000 +0000
@@ -0,0 +1,366 @@
+#ifndef _INCLUDE_LOG4CPP_CONFIG_VXWORKS_H
+#define _INCLUDE_LOG4CPP_CONFIG_VXWORKS_H 1
+
+/* manually edited from include/log4cpp/config.h */
+
+/* Other fixes for building for VxWorks and other compiler/script warnings
+
+* include/log4cpp/config-vxworks.h: Added for custom forcing settings
+*
+* include/log4cpp/PatternLayout.hh: doxygen syntax
+* include/log4cpp/Portability.hh: use config-vxworks.h on VxWorks. Note: Portability.hh for use in *.hh files; In *.cpp use PortabilityImpl.hh with added inlines.
+* include/log4cpp/Priority.hh: enum syntax (trailing comma)
+* src/Category.cpp: Superflous Scope specification
+* src/FileAppender.cpp: conflicting write() declaration
+* src/Localtime.cpp: use string.h not memory.h
+* src/Priority.cpp: log entry type keyword strings
+* tests/Clock.hh: sys/times.h not sys/time.h for struct timeval in Vxworks kernel. Portability.hh missing.
+* include/log4cpp/RemoteSyslogAppender.hh: enum syntax (trailing comma)
+* src/RemoteSyslogAppender.cpp: need hostLib.h for e.g. gethostbyname(0
+* src/RemoteSyslogAppender.cpp: #include <sockLib.h> for e.g. socket(), sendto() etc
+* src/BasicConfigurator.cpp: # include <ioLib.h>  For dup() __RTP__: Also unistd.h
+* src/SimpleConfigurator.cpp: # include <ioLib.h>  For dup() __RTP__: Also unistd.h
+* tests/Clock.cpp: in Kernel sys/times.h instead of Linux and __RTP__ sys/time.h for struct timeval; clock_gettime(CLOCK_REALTIME) not gettimeofday() PortabilityImpl.hh missing.
+* 
+* log4cpp.spec: removed, generated by configure
+*
+* configure for pthreads, see below, optional
+* bcb5/log4cpp/Makefile.in - by mistake? 
+* 	"INSTALL_c_PROGRAM = @INSTALL_STRIP_PROGRAM@" instead of "INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@"
+*
+* doc/Doxyfile.in: doxygen warning, obsolete parameter
+* 
+ */
+
+/* Add  appropriate #include in Portability.h:
+ * #if defined (_MSC_VER) || defined(__BORLANDC__)
+ * ...
+#elif defined(__vxworks)
+#else
+#        include <log4cpp/config-vxworks.h>
+#endif
+ * Predefined Macros for powerpc-wrs-vxworks see: touch foo.h; cppppc -dM foo.h; rm foo.h
+ * Check both GNU 2.96 for VxWorks 5.x and GNU 3.x or 4.x for VxWorks 6.x to prefer version independent Macros.
+ * __vxworks
+ * For VxWorks 6.x see also _WRS_KERNEL and __RTP__ to differentiate between kernel space and application process space
+ * See also _ARCH_PPC, __BIG_ENDIAN__
+ */
+
+#if 0
+/* include/log4cpp/config.h. Generated automatically at end of configure. */
+/* include/config.h.  Generated from config.h.in by configure.  */
+/* include/config.h.in.  Generated from configure.in by autoheader.  */
+#endif
+
+/* Define to 1 if you have the <dlfcn.h> header file. */
+/* Only in VxWorks application processes! */
+/* #undef LOG4CPP_HAVE_DLFCN_H */
+#ifndef LOG4CPP_HAVE_DLFCN_H
+#ifdef __RTP__
+#define LOG4CPP_HAVE_DLFCN_H 1
+#endif
+#endif
+
+/* Define to 1 if you have the `ftime' function. */
+/* #undef LOG4CPP_HAVE_FTIME */
+
+/* Define to 1 if you have the `gettimeofday' function. */
+/* Used despite the exclusion in Clock.cpp */
+/* Anyway timezones undefined and not used, therefore clock_gettime(CLOCK_REALTIME) is as good as well.
+ * Note conversion from nsec to usec, see timeval vs. timespec, note time.h not sys/time.h
+ */
+/* VxWorks __RTP__ : declared in sys/time.h but still not available */
+/* VxWorks _WRS_KERNEL : not available */
+/* #undef LOG4CPP_HAVE_GETTIMEOFDAY */
+
+/* define if the compiler has int64_t */
+/* #undef LOG4CPP_HAVE_INT64_T */
+#ifndef LOG4CPP_HAVE_INT64_T
+#define LOG4CPP_HAVE_INT64_T 1
+#endif
+
+/* Define to 1 if you have the <inttypes.h> header file. */
+/* Only in application processes!!!!! */
+/* #undef LOG4CPP_HAVE_INTTYPES_H */
+#ifndef LOG4CPP_HAVE_INTTYPES_H
+#ifdef __RTP__
+#define LOG4CPP_HAVE_INTTYPES_H 1
+#endif
+#endif
+
+/* Define to 1 if you have the <io.h> header file. */
+/* #undef LOG4CPP_HAVE_IO_H */
+
+/* Define to 1 if you have the `idsa' library (-lidsa). */
+/* #undef LOG4CPP_HAVE_LIBIDSA */
+
+/* Wrong by autoconfigure! */
+/* Define to 1 if you have the `localtime_r' function. */
+/* #undef LOG4CPP_HAVE_LOCALTIME_R */
+#ifndef LOG4CPP_HAVE_LOCALTIME_R
+#define LOG4CPP_HAVE_LOCALTIME_R 1
+#endif
+
+/* Wrong by autoconfigure! define to get around problems with ERROR and DEBUG in vxWorks.h
+ * 
+ * ERROR and DEBUG used by Priority.hh as scoped C++ symbol.
+ * but Macros override the value in all Scopes. 
+ * 
+ * In VxWorks Application Processes (#if defined(__RTP__) ), Name collision free pure Posix
+ * conformance could be enforced by #define _POSIX_C_SOURCE 200112L. But this precludes
+ * some VxWorks features in this application.
+ * Don't taking care about further VxWorks Process details for now.
+ * 
+ * For VxWorks Kernel Process:
+ * DEBUG:
+ *   Used only as #ifdef by compiler command line. Value irrelevant.
+ *   Sufficient to override #define DEBUG DEBUG to keep meaning when used as C++ symbol.
+ * ERROR:
+ *   Value is important, defined by VxWorks indirectly included header file.
+ *
+ *   Need to put a variable ERROR with the correct value into global scope, in addition to
+ *   override #define ERROR ERROR. Then VxWorks as well as scoped use of ERROR expand to the
+ *   proper variable. static linkage is sufficient, because Priority.hh included in all conflicting files.
+ *
+ *   It must be prevented, that #define ERROR is overriden by a later VxWorks header
+ *   after it got fixed in Priority.hh
+ *   Unfortunately system headers do not show a warning on override, see -isystem, -Wsystem-headers
+ *   Also the Priority.hh fix is only in effect, if the VxWorks value was already defined before.
+ *   Therefore in Portability.hh always refering the platform specific value by an
+ *   extern const int ERROR_platform variable in PortabilityImpl.cpp does not help.
+ *   Also it is not obvious what OS internal header file got indirectly included, and therefore
+ *   there is no specific correct log4cpp header inclusion order.
+ *   The only way is, to include the entire OS specific header which defines ERROR, to benefit from the
+ *   double inclusion protection. This must be done within a sub include of Portability.hh, to
+ *   be sure that it is available before Priority.hh
+ *   The minimum system header which fullfills this, and does not collide with VxWorks.h inclusion
+ *   order is vxWorksCommon.h
+ */   
+#ifndef LOG4CPP_FIX_ERROR_COLLISION
+#define LOG4CPP_FIX_ERROR_COLLISION 1
+#endif
+#include <vxWorksCommon.h>
+
+/* Define to 1 if you have the <memory.h> header file. */
+/* Note: With VxWorks corresponding functions are in string.h instead
+ * either create a forwarding memory.h in the application or handle at memory.h usage.
+ * Anyway with log4cpp the only occurence in Localtime.cpp is not used because of available localtime_r
+ * Alternatively: #include string.h or other memcpy declaration right here, to get by with skipping memory.h at usage locations.
+ */
+/* #undef LOG4CPP_HAVE_MEMORY_H */
+
+/* define if the compiler implements namespaces */
+#ifndef LOG4CPP_HAVE_NAMESPACES 
+#define LOG4CPP_HAVE_NAMESPACES   
+#endif
+
+/* src/m4/ACX_PTHREAD.m4 is one of the templates which together are making up the configure script
+ * Near beginning of configure script see acx_pthread_ok=no
+ * This activates the tests further below for pthread availability, compiler options and capability.
+ * Alternate executable pthread-config to return necessary compiler options not present and fails.
+ * With VxWorks it is unnecessary to set special compiler/linker options for pthread.  
+ * Further tests in configure fail, because on the fly building and executing a pthread executable
+ *   which does not work without access to target.
+ * This will show misleading pthread off in ../configure.log, config.log and other config.h* 
+ * Note: config.log with #define HAVE_PTHREAD refers to non existing confdefs.h, similar to auto-generated
+ *   include/config.h with template include/config.h.in
+ *   include/log4cpp/config.h is the template of include/log4cpp/config-vxworks.h
+ * Are other config* settings effective, or is always config-vxworks.h taking precedence after the other settings?
+ *  See Portability.hh - on platform specific config*.h, plain config.h completely ignored!
+ *  On *.hh #include Portability.hh, on *.cpp #include PortabilityImpl.hh with added inline functions!
+ * Success of the configure test can be forced by setting acx_pthread_ok=yes at beginning of pthread tests in configure.
+ * But this will affect both ws and lcu side.
+ * 
+ * However forcing the pthreads availability in config-vxworks.h is not sufficient, because on original configure
+ * behaviour on cross compiling the configure fails with:
+ * 
+ * configure: error: unable to find pthreads, currently this is required
+ * 
+ * This error is triggered by the log4cpp specific configure.in at ACX_PTHREAD,
+ * which by autoconfigure gets converted to the configure script,
+ * which involves inclusion of the *.m4 tests.
+ * Since log4cpp seem to depends on pthreads, no point in removing this test.
+ * Also for now it is not desired to regenerate so much of the build mechanism in the log4cpp package.
+ * So patch configure and ACX_PTHREAD.m4 consistently to fake success on cross compiling.
+ * But on the linux side the behaviour must be unchanged.
+ * Therefore replace initial 'acx_pthread_ok=no' in ACX_PTHREAD.m4 and configure by the following:
+ * 
+ * if test "$cross_compiling" != no; then
+ * 	acx_pthread_ok=no
+ * else
+ * 	acx_pthread_ok=yes
+ *     AC_MSG_WARN([On cross compiling without remote execution, the pthreads capability probe application \
+ *     	cannot be executed. For now fake success of HAVE_PTHREAD, HAVE_THREADING, USE_PTHREADS \
+ *     	and assume no pthreads specific PTHREAD_LIBS and PTHREAD_CFLAGS ])
+ * fi
+ * 
+ * In configure replace multi line
+ * AC_MSG_WARN([...\
+ * ...])
+ * by
+ * { echo "$as_me:$LINENO: WARNING: ...
+ * ..." >&5
+ * echo "$as_me: WARNING: ...
+ * ..." >&2;}
+ * 
+ */
+
+/* Define if you have POSIX threads libraries and header files. */
+#ifndef LOG4CPP_HAVE_PTHREAD 
+#define LOG4CPP_HAVE_PTHREAD  1 
+#endif
+
+/* define if the C library has snprintf */
+/* Wrong by autoconf! */
+/* #undef LOG4CPP_HAVE_SNPRINTF */
+#ifndef LOG4CPP_HAVE_SNPRINTF 
+#define LOG4CPP_HAVE_SNPRINTF  1 
+#endif
+
+/* define if the compiler has stringstream */
+#ifndef LOG4CPP_HAVE_SSTREAM 
+#define LOG4CPP_HAVE_SSTREAM   
+#endif
+
+/* define if you have the <stdint.h> header file. */
+/* Only in application processes!!!!! */
+/* #undef LOG4CPP_HAVE_STDINT_H */
+#ifndef LOG4CPP_HAVE_STDINT_H 
+#ifdef __RTP__
+#define LOG4CPP_HAVE_STDINT_H
+#endif
+#endif
+
+/* Define to 1 if you have the <stdlib.h> header file. */
+#ifndef LOG4CPP_HAVE_STDLIB_H 
+#define LOG4CPP_HAVE_STDLIB_H  1 
+#endif
+
+/* Define to 1 if you have the <strings.h> header file. */
+#ifndef LOG4CPP_HAVE_STRINGS_H 
+#define LOG4CPP_HAVE_STRINGS_H  1 
+#endif
+
+/* Define to 1 if you have the <string.h> header file. */
+#ifndef LOG4CPP_HAVE_STRING_H 
+#define LOG4CPP_HAVE_STRING_H  1 
+#endif
+
+/* Define to 1 if you have the `syslog' function. */
+/* #undef LOG4CPP_HAVE_SYSLOG */
+
+/* Define to 1 if you have the <sys/stat.h> header file. */
+#ifndef LOG4CPP_HAVE_SYS_STAT_H 
+#define LOG4CPP_HAVE_SYS_STAT_H  1 
+#endif
+
+/* Define to 1 if you have the <sys/types.h> header file. */
+#ifndef LOG4CPP_HAVE_SYS_TYPES_H 
+#define LOG4CPP_HAVE_SYS_TYPES_H  1 
+#endif
+
+/* define if threading is enabled */
+#ifndef LOG4CPP_HAVE_THREADING 
+#define LOG4CPP_HAVE_THREADING  1 
+#endif
+
+/* Define to 1 if you have the <unistd.h> header file. */
+/* Most is also in ioLib.h but with slightly different prototype.
+ * Linux unistd.h: extern ssize_t write (int __fd, __const void *__buf, size_t __n) __wur;
+ * VxWorks6.7 unistd.h: extern int 		write (int fd, char *buffer, size_t nbytes);
+ * VxWorks 6.7 ioLib.h: extern ssize_t	write (int, const void *, size_t);
+ * All Vxworks variants result in a const or propagation violation in FileAppender.cpp
+ * Instead of including unistd.h here and #define write temporarily to something else and providing the correct declaration,
+ * So far workaround at occurence of unistd.h for FileAppender.cpp FileAppender::_append
+ */
+#ifndef LOG4CPP_HAVE_UNISTD_H 
+#define LOG4CPP_HAVE_UNISTD_H  1 
+#endif
+
+/* Name of package */
+#ifndef LOG4CPP_PACKAGE 
+#define LOG4CPP_PACKAGE  "log4cpp" 
+#endif
+
+/* Define to the address where bug reports for this package should be sent. */
+#ifndef LOG4CPP_PACKAGE_BUGREPORT 
+#define LOG4CPP_PACKAGE_BUGREPORT  "" 
+#endif
+
+/* Define to the full name of this package. */
+#ifndef LOG4CPP_PACKAGE_NAME 
+#define LOG4CPP_PACKAGE_NAME  "log4cpp" 
+#endif
+
+/* Define to the full name and version of this package. */
+#ifndef LOG4CPP_PACKAGE_STRING 
+#define LOG4CPP_PACKAGE_STRING  "log4cpp 1.0" 
+#endif
+
+/* Define to the one symbol short name of this package. */
+#ifndef LOG4CPP_PACKAGE_TARNAME 
+#define LOG4CPP_PACKAGE_TARNAME  "log4cpp" 
+#endif
+
+/* Define to the version of this package. */
+#ifndef LOG4CPP_PACKAGE_VERSION 
+#define LOG4CPP_PACKAGE_VERSION  "1.0" 
+#endif
+
+/* Define to necessary symbol if this constant uses a non-standard name on
+   your system. */
+#ifndef LOG4CPP_PTHREAD_CREATE_JOINABLE 
+#define LOG4CPP_PTHREAD_CREATE_JOINABLE  unknown 
+#endif
+
+/* Define to 1 if you have the ANSI C header files. */
+#ifndef LOG4CPP_STDC_HEADERS 
+#define LOG4CPP_STDC_HEADERS  1 
+#endif
+
+/* define if pthread library is available */
+#ifndef LOG4CPP_USE_PTHREADS 
+#define LOG4CPP_USE_PTHREADS  1 
+#endif
+
+/* Version number of package */
+#ifndef LOG4CPP_VERSION 
+#define LOG4CPP_VERSION  "1.0" 
+#endif
+
+#if defined(__vxworks) && !defined(__RTP__)
+/* This Macro should immediately precede all main definitions and contain the application name:
+ * LOG4CPP_MAIN_DECL(example_appname)
+ * int main(int argc, char *argv[]) { ... }
+ * By default definition of Portability.hh expands to nothing, but config-xxx.h can redefine it.
+ * 
+ * VxWorks loadable kernel modules are in the same already running process,
+ * and therefore do not have the concept of a main function.
+ * Therefore config-vxworks.h redefines the Macro to convert main into a suitable declaration.
+ * 
+ * common name main needs to be static. Since the compiler treats main special,
+ * need to redefine it to main_static by a Macrp.
+ *  
+ * provide a C function which takes a const string for the arguments.
+ * This converts the string to the argc/argv form and calls the local main function.
+ * 
+ * argument conversion function centralized in PortabilityImpl.cpp
+ */
+
+#define main main_static
+
+int log4cpp_maincall(const char *args, int (*main)(int argc, char** argv), char *appname );
+
+#undef LOG4CPP_MAIN_DECL
+#define LOG4CPP_MAIN_DECL(appname) \
+static int main(int argc, char** argv); \
+extern "C" int appname( const char *args) \
+{ \
+	return log4cpp_maincall(args, main, #appname); \
+} \
+static
+
+#endif
+
+/* _INCLUDE_LOG4CPP_CONFIG_VXWORKS_H */
+#endif
diff -Naur log4cpp-1.0/include/log4cpp/PatternLayout.hh log4cpp-1.0+/include/log4cpp/PatternLayout.hh
--- log4cpp-1.0/include/log4cpp/PatternLayout.hh	2003-03-10 09:01:16.000000000 +0000
+++ log4cpp-1.0+/include/log4cpp/PatternLayout.hh	2011-02-11 17:14:06.908856000 +0000
@@ -62,6 +62,7 @@
          * Sets the format of log lines handled by this
          * PatternLayout. By default, set to "%%m%%n".<br>
          * Format characters are as follows:<br>
+         * <ul>
          * <li><b>%%</b> - a single percent sign</li>
          * <li><b>%%c</b> - the category</li>
          * <li><b>%%d</b> - the date\n
@@ -78,6 +79,7 @@
          * <li><b>%%R</b> - seconds since Jan 1, 1970</li>
          * <li><b>%%u</b> - clock ticks since process start</li>
          * <li><b>%%x</b> - the NDC</li>
+         * </ul>
          * @param conversionPattern the conversion pattern
          * @exception ConfigureFailure if the pattern is invalid
          **/
diff -Naur log4cpp-1.0/include/log4cpp/Portability.hh log4cpp-1.0+/include/log4cpp/Portability.hh
--- log4cpp-1.0/include/log4cpp/Portability.hh	2007-07-03 17:19:36.000000000 +0000
+++ log4cpp-1.0+/include/log4cpp/Portability.hh	2011-02-11 17:14:06.912818000 +0000
@@ -10,12 +10,24 @@
 #ifndef _LOG4CPP_PORTABILITY_HH
 #define _LOG4CPP_PORTABILITY_HH
 
+/* This Macro should immediately precede all main definitions and contain the application name:
+ * LOG4CPP_MAIN_DECL(example_appname)
+ * int main(int argc, char *argv[]) { .. }
+ * By default definition of Portability.hh expands to nothing, but config-xxx.h can redefine it.
+ * E.g.  VxWorks loadable kernel modules are in the same already running process,
+ * and therefore do not have the concept of a main function.
+ * Therefore config-vxworks.h redefines the Macro to convert main into a suitable declaration.
+ */
+#define LOG4CPP_MAIN_DECL(appname)
+
 #if defined (_MSC_VER) || defined(__BORLANDC__)
 #    if defined (LOG4CPP_STLPORT_AND_BOOST_BUILD)
 #        include <log4cpp/config-win32-stlport-boost.h>
 #    else
 #        include <log4cpp/config-win32.h>
 #    endif
+#elif defined(__vxworks)
+#        include <log4cpp/config-vxworks.h>
 #else
 #if defined(__OPENVMS__)
 #    include <log4cpp/config-openvms.h>
diff -Naur log4cpp-1.0/include/log4cpp/Priority.hh log4cpp-1.0+/include/log4cpp/Priority.hh
--- log4cpp-1.0/include/log4cpp/Priority.hh	2005-10-17 08:03:16.000000000 +0000
+++ log4cpp-1.0+/include/log4cpp/Priority.hh	2011-02-11 17:14:06.914825000 +0000
@@ -69,14 +69,19 @@
          **/
         typedef enum {EMERG  = 0, 
 		      FATAL  = 0,
+              EMERGENCY = 0,
                       ALERT  = 100,
                       CRIT   = 200,
+                      CRITICAL = 200,
                       ERROR  = 300, 
                       WARN   = 400,
+                      WARNING = 400,
                       NOTICE = 500,
                       INFO   = 600,
                       DEBUG  = 700,
-                      NOTSET = 800
+                      DELOUSE = 800,
+                      TRACE = 900,
+                      NOTSET = 1000
         } PriorityLevel;
 
         /**
diff -Naur log4cpp-1.0/include/log4cpp/RemoteSyslogAppender.hh log4cpp-1.0+/include/log4cpp/RemoteSyslogAppender.hh
--- log4cpp-1.0/include/log4cpp/RemoteSyslogAppender.hh	2005-04-12 17:57:14.000000000 +0000
+++ log4cpp-1.0+/include/log4cpp/RemoteSyslogAppender.hh	2011-02-11 17:14:06.961817000 +0000
@@ -33,7 +33,7 @@
     LOG_WARNING = 4,       ///< warning conditions
     LOG_NOTICE  = 5,       ///< normal but significant condition
     LOG_INFO    = 6,       ///< informational
-    LOG_DEBUG   = 7,       ///< debug-level messages
+    LOG_DEBUG   = 7/*,*/       ///< debug-level messages
 } SyslogLevel;
 
 typedef enum {
@@ -58,7 +58,7 @@
     LOG_LOCAL4   = (20<<3), ///< reserved for local use
     LOG_LOCAL5   = (21<<3), ///< reserved for local use
     LOG_LOCAL6   = (22<<3), ///< reserved for local use
-    LOG_LOCAL7   = (23<<3), ///< reserved for local use
+    LOG_LOCAL7   = (23<<3)/*,*/ ///< reserved for local use
 } SyslogFacility;
 #endif
 
diff -Naur log4cpp-1.0/log4cpp.spec log4cpp-1.0+/log4cpp.spec
--- log4cpp-1.0/log4cpp.spec	2007-09-03 09:54:04.000000000 +0000
+++ log4cpp-1.0+/log4cpp.spec	1970-01-01 00:00:00.000000000 +0000
@@ -1,97 +0,0 @@
-%define  RELEASE 4
-%define  rel     %{?CUSTOM_RELEASE} %{!?CUSTOM_RELEASE:%RELEASE}
-
-%define lib_name log4cpp
-%define manualdir       /var/www/html/manual/%{name}
-
-Name: log4cpp
-Version: 1.0
-Release: %rel
-
-Summary: Log for C++
-License: LGPL
-Group: Development/Libraries
-Vendor:  Bastiaan Bakker <bastiaan.bakker@lifeline.nl>
-Packager: Cedric Le Goater <cedric@legoater.com>
-Url: http://log4cpp.sourceforge.net/
-
-Source: ftp://download.sourceforge.net/pub/sourceforge/log4cpp/%name-%version.tar.gz
-
-Prefix: %_prefix
-BuildRoot: %_tmppath/%name-%version-root
-
-%description
-Log for C++ is a library of classes for flexible logging to files, syslog,
-and other destinations. It is modeled after the Log for Java library and
-stays as close to its API as is reasonable.
-
-%package devel
-Summary: development tools for Log for C++
-Group: Development/Libraries
-Requires: %name = %version
-
-%description devel
-The %name-devel package contains the static libraries and header files
-needed for development with %name.
-
-%package doc
-Summary: HTML formatted API documention for Log for C++
-Group: Development/Libraries
-#can't set doc package to noarch without setting the others as well.
-#BuildArch: noarch
-%{!?_without_doxygenrpm:BuildRequires: doxygen}
-
-%description doc
-The %name-doc package contains HTML formatted API documention generated by
-the popular doxygen documentation generation tool.
-
-%prep
-%{__rm} -rf $RPM_BUILD_ROOT
-
-%setup
-CC=%{__cc} CXX=%{__cxx} ./configure --prefix=%{prefix} --enable-doxygen 
-
-%build
-%{__make}
-
-%install
-%{__rm} -rf $RPM_BUILD_ROOT
-
-%{__make} prefix=$RPM_BUILD_ROOT%{prefix}docdir=$RPM_BUILD_ROOT/%{manualdir} install
-%clean
-%{__rm} -rf $RPM_BUILD_ROOT
-
-%ifnos solaris2.8 solaris2.9 solaris2.10
-%post -p /sbin/ldconfig
-%endif
-
-%post devel
-if test "x$RPM_INSTALL_PREFIX0" != "x" ; then
-    %{__perl} -pi -e"s|^libdir='[^\']*'|libdir='$RPM_INSTALL_PREFIX0/lib'|" $RPM_INSTALL_PREFIX0/lib/liblog4cpp.la
-    %{__perl} -pi -e"s|^prefix=\"[^\"]*\"|prefix=\"$RPM_INSTALL_PREFIX0\"|" $RPM_INSTALL_PREFIX0/bin/log4cpp-config
-fi
-
-%ifnos solaris2.8 solaris2.9 solaris2.10 
-%postun -p /sbin/ldconfig
-%endif
-
-%files
-%defattr(-,root,root,755)
-%attr(755,root,root) %prefix/lib/lib*.so.*
-%doc AUTHORS COPYING INSTALL NEWS README THANKS ChangeLog
-
-%files devel
-%defattr(-,root,root,755)
-%prefix/include/*
-%prefix/man/*
-%attr(755,root,root) %prefix/bin/log4cpp-config
-%attr(755,root,root) %prefix/lib/lib*.so
-%attr(644,root,root) %prefix/lib/*.*a
-%attr(644,root,root) %prefix/lib/pkgconfig/log4cpp.pc
-%attr(644,root,root) %prefix/share/aclocal/*.m4
-
-%files doc
-%defattr(-,root,root)
-%doc %{manualdir}
-
-
diff -Naur log4cpp-1.0/m4/ACX_PTHREAD.m4 log4cpp-1.0+/m4/ACX_PTHREAD.m4
--- log4cpp-1.0/m4/ACX_PTHREAD.m4	2007-08-24 05:51:58.000000000 +0000
+++ log4cpp-1.0+/m4/ACX_PTHREAD.m4	2011-02-11 17:14:06.965817000 +0000
@@ -87,7 +87,15 @@
 AC_REQUIRE([AC_CANONICAL_HOST])
 AC_LANG_SAVE
 AC_LANG_C
-acx_pthread_ok=no
+
+if test "$cross_compiling" != no; then
+	acx_pthread_ok=no
+else
+	acx_pthread_ok=yes
+    AC_MSG_WARN([On cross compiling without remote execution, the pthreads capability probe application \
+    	cannot be executed. For now fake success of HAVE_PTHREAD, HAVE_THREADING, USE_PTHREADS \
+    	and assume no pthreads specific PTHREAD_LIBS and PTHREAD_CFLAGS])
+fi	
 
 # We used to check for pthread.h first, but this fails if pthread.h
 # requires special compiler flags (e.g. on True64 or Sequent).
diff -Naur log4cpp-1.0/src/BasicConfigurator.cpp log4cpp-1.0+/src/BasicConfigurator.cpp
--- log4cpp-1.0/src/BasicConfigurator.cpp	2002-10-26 18:30:55.000000000 +0000
+++ log4cpp-1.0+/src/BasicConfigurator.cpp	2011-02-11 17:14:06.967812000 +0000
@@ -13,6 +13,9 @@
 #ifdef LOG4CPP_HAVE_UNISTD_H
 #    include <unistd.h>
 #endif
+#if defined(__vxworks) && !defined(__RTP__)
+ # include <ioLib.h>  /* For dup(), otherwise in unistd.h */
+#endif
 
 #include <cstdio>
 #include <log4cpp/BasicConfigurator.hh>
diff -Naur log4cpp-1.0/src/Category.cpp log4cpp-1.0+/src/Category.cpp
--- log4cpp-1.0/src/Category.cpp	2002-10-27 01:38:15.000000000 +0000
+++ log4cpp-1.0+/src/Category.cpp	2011-02-11 17:14:06.969816000 +0000
@@ -200,8 +200,13 @@
     }
 
     /* assume lock is held */
+    /* bool Category::ownsAppender(Appender* appender, 
+                                Category::OwnsAppenderMap::iterator& i2) throw() { }
+     * typedef OwnsAppenderMap declared in Category. Over-specify produces
+     * Warning: no uniquely matching class member found for ... Possible candidates: ...
+     */
     bool Category::ownsAppender(Appender* appender, 
-                                Category::OwnsAppenderMap::iterator& i2) throw() {
+                                OwnsAppenderMap::iterator& i2) throw() {
         bool owned = false;
 
         if (NULL != appender) {
diff -Naur log4cpp-1.0/src/FileAppender.cpp log4cpp-1.0+/src/FileAppender.cpp
--- log4cpp-1.0/src/FileAppender.cpp	2006-09-30 06:03:20.000000000 +0000
+++ log4cpp-1.0+/src/FileAppender.cpp	2011-02-11 17:14:06.972832000 +0000
@@ -12,7 +12,14 @@
 #    include <io.h>
 #endif
 #ifdef LOG4CPP_HAVE_UNISTD_H
+#ifdef __vxworks
+#  define write write_vx_unistd_unused
 #    include <unistd.h>
+#  undef write
+extern "C" ssize_t write (int fd, const char *buffer, size_t nbytes);
+#else
+#    include <unistd.h>
+#endif
 #endif
 
 #include <memory>
diff -Naur log4cpp-1.0/src/Localtime.cpp log4cpp-1.0+/src/Localtime.cpp
--- log4cpp-1.0/src/Localtime.cpp	2007-08-19 10:20:18.000000000 +0000
+++ log4cpp-1.0+/src/Localtime.cpp	2011-02-11 17:14:06.974841000 +0000
@@ -1,7 +1,6 @@
 #include <log4cpp/Portability.hh>
 #include "Localtime.hh"
 #include <time.h>
-#include <memory.h>
 
 namespace log4cpp         
 {
@@ -21,6 +20,13 @@
 #endif
 
 #if !defined(LOG4CPP_HAVE_LOCALTIME_R)
+  #ifdef LOG4CPP_HAVE_MEMORY_H   
+    #include <memory.h>
+#elif defined(__vxworks) 
+    #include <string.h> /* Not reached because VxWorks has LOG4CPP_HAVE_LOCALTIME_R */
+#else
+    /* memcpy undeclared or non existing */ 
+#endif   
    void localtime(const ::time_t* time, ::tm* t)
    {
       ::tm* tmp = ::localtime(time);
diff -Naur log4cpp-1.0/src/PortabilityImpl.cpp log4cpp-1.0+/src/PortabilityImpl.cpp
--- log4cpp-1.0/src/PortabilityImpl.cpp	2002-10-27 19:44:50.000000000 +0000
+++ log4cpp-1.0+/src/PortabilityImpl.cpp	2011-02-11 17:14:06.978811000 +0000
@@ -25,3 +25,39 @@
 }
 
 #endif
+
+#if defined(__vxworks) && !defined(__RTP__)
+/* VxWorks loadable kernel modules are in the same already running process,
+ * and therefore do not have the concept of a main function.
+ * Therefore by macro LOG4CPP_MAIN_DECL(example_appname) of config-vxworks.h/Portability.hh,
+ * An application specific function name is provided, which takes a string
+ * and passes the string together with the main function name on to here for parameter
+ * conversion to argc/argv and propagation to the passed main function.
+ * getOptServ rejects NULL and "" empty arguments. Special treatment to accept this cases.
+ */ 
+
+#include <unistd.h>
+#include <string.h>
+
+#define ARGC_MAX 64
+#define ARGS_MAX 512
+int log4cpp_maincall(const char *args, int (*main)(int argc, char** argv), char *appname )
+{
+	int argc;
+	char* argv[ARGC_MAX];
+	char argsm[ARGS_MAX];
+	
+	if (args == NULL || *args == '\0') {
+		argv[0] = appname;
+		argv[1] = NULL;
+		argc = 1;
+	} else {
+		strncpy(argsm,args,ARGS_MAX);
+		if ( getOptServ(argsm,appname,&argc,argv,ARGC_MAX) ) {
+			return 1;
+		}
+	}
+	return main(argc, argv);
+}
+#endif //defined(__vxworks) && !defined(__RTP__)
+
diff -Naur log4cpp-1.0/src/Priority.cpp log4cpp-1.0+/src/Priority.cpp
--- log4cpp-1.0/src/Priority.cpp	2005-10-17 08:03:16.000000000 +0000
+++ log4cpp-1.0+/src/Priority.cpp	2011-02-11 17:14:06.979826000 +0000
@@ -14,28 +14,30 @@
 namespace log4cpp {
 
     namespace {
-        const std::string names[10] = {
-            "FATAL",
+        const std::string names[12] = {
+            "EMERGENCY",
 			"ALERT",
-			"CRIT",
+			"CRITICAL",
 			"ERROR",
-			"WARN",
+			"WARNING",
             "NOTICE",
 			"INFO",
 			"DEBUG",
+            "DELOUSE",
+            "TRACE",
 			"NOTSET",
 			"UNKNOWN" 
         };
     }    
 
-    const int log4cpp::Priority::MESSAGE_SIZE = 8;
+    const int log4cpp::Priority::MESSAGE_SIZE = 10;
     
 
     const std::string& Priority::getPriorityName(int priority) throw() {
          
         priority++;
         priority /= 100;
-        return names[((priority < 0) || (priority > 8)) ? 8 : priority];
+        return names[((priority < 0) || (priority > 10)) ? 10 : priority];
     }
 
     Priority::Value Priority::getPriorityValue(const std::string& priorityName) 
diff -Naur log4cpp-1.0/src/RemoteSyslogAppender.cpp log4cpp-1.0+/src/RemoteSyslogAppender.cpp
--- log4cpp-1.0/src/RemoteSyslogAppender.cpp	2007-07-03 09:17:27.000000000 +0000
+++ log4cpp-1.0+/src/RemoteSyslogAppender.cpp	2011-02-11 17:14:06.981830000 +0000
@@ -29,6 +29,10 @@
 #include <sys/socket.h>
 #include <netinet/in.h>
 #include <arpa/inet.h>
+#ifdef __vxworks
+#include <hostLib.h> /* for e.g. gethostbyname() */
+#include <sockLib.h> /* for e.g. socket(), sendto() etc */
+#endif
 #endif
 
 namespace log4cpp {
diff -Naur log4cpp-1.0/src/SimpleConfigurator.cpp log4cpp-1.0+/src/SimpleConfigurator.cpp
--- log4cpp-1.0/src/SimpleConfigurator.cpp	2007-07-03 09:17:28.000000000 +0000
+++ log4cpp-1.0+/src/SimpleConfigurator.cpp	2011-02-11 17:14:06.984813000 +0000
@@ -13,6 +13,9 @@
 #ifdef LOG4CPP_HAVE_IO_H
 #    include <io.h>
 #endif
+#if defined(__vxworks) && !defined(__RTP__)
+ # include <ioLib.h>  /* For dup(), otherwise in unistd.h */
+#endif
 
 #include <stdio.h>
 #include <iostream>
diff -Naur log4cpp-1.0/tests/Clock.cpp log4cpp-1.0+/tests/Clock.cpp
--- log4cpp-1.0/tests/Clock.cpp	2002-09-15 22:40:50.000000000 +0000
+++ log4cpp-1.0+/tests/Clock.cpp	2011-02-11 17:14:06.986817000 +0000
@@ -4,8 +4,21 @@
  * See the COPYING file for the terms of usage and distribution.
  */
 
+#include <PortabilityImpl.hh>
+
 #include <cstdlib>
+#ifndef LOG4CPP_HAVE_GETTIMEOFDAY
+#include <time.h> //For clock_gettime
+#endif
+#if defined(__vxworks) && !defined(__RTP__)
+#include <sys/times.h>			// for struct timeval
+#if (defined(__ppc) || defined(__386))
+#include <vxLib.h>	// For vxTimeBaseGet() and pentiumTscGet64()
+#include <sysLib.h> // For sysTimestampFreq() in drv/timer/timerDev.h
+#endif
+#else
 #include <sys/time.h>			// for struct timeval
+#endif
 #ifdef __osf__
 #    include <machine/builtins.h>       // for __RPCC()
 #elif __linux__ && __i386__
@@ -21,7 +34,22 @@
     const usec_t UsecPerSec = INT64_CONSTANT(1000000);
 }
 
+#if defined(__vxworks) && !defined(__RTP__) && (defined(__ppc) || defined(__386))
+/* For consistency with rest of application, don't check for defined(_WRS_KERNEL), but for !defined(__RTP__)
+ * In VxWorks kernel process, access to CPU clock is always possible,
+ * and the value can be scaled according to frequency.
+ * Therefore in VxWorks kernel, CPU clock is more precise as Posix Time, as opposed to Linux. 
+ * Clock.cpp implements only Pentium and PowerPC.
+ * For consistency between DIAB and GNU check for __386, not for __386__.  Don't care about 80486.
+ * C++ static member variable initialized at load time, not at start time.
+ * To avoid forgetting putenv("CLOCK_USE_CPU=1") ahead of time, make it default.
+ * VxWorks timestamp has a typical resolution of > 10 MHz (PPC) or > 1 GHz (IA)
+ * clock_gettime(CLOCK_REALTIME,&ts) has only a resolution of 1/sysClkRateGet(), typically (200/3) hz 
+ */
+bool Clock::UsingCPU  = true;
+#else
 bool Clock::UsingCPU  = std::getenv("CLOCK_USE_CPU") ? true : false;
+#endif
 
 // -----------------------------------------------------------------------------
 usec_t Clock::time(void)
@@ -39,10 +67,53 @@
 #elif __linux__ && __i386__
 	{
 	    unsigned long tsc;
-			
+
+		/* Attention!
+		 * Not scaled to 1 MHz! Can run up to several MHz!
+		 * Only lower 32Bits returned! Can roll over within a second!
+		 */
 	    rdtscl(tsc);
 	    return (usec_t) tsc;
 	}
+#elif defined(__vxworks) && !defined(__RTP__) && (defined(__ppc) || defined(__386))
+	{
+		static unsigned frequency = 0;
+		usec_t timestamp;
+		
+		/* Retrieve only once. Alternatively put it into a static class member variable. */
+		if (!frequency) {
+			frequency = sysTimestampFreq();
+			if (!frequency) {
+			    std::cerr << "CPU clock not implemented for this architecture" << std::endl;
+			    UsingCPU = false;
+			    return Clock::time();
+			}
+		}
+
+		/* By convention and historic restriction, in most VxWorks configurations
+		 * sysTimestamp() resets to 0 with every tick (default (200/3) Hz).
+		 * Therefore access a 64 bit CPU timer with same frequency and continuous run.
+		 * On integer math propagate to 64 Bit before doing computation!
+		 */
+#ifdef __ppc
+		unsigned hi;
+		unsigned lo;
+		
+		vxTimeBaseGet(&hi,&lo);
+		timestamp = ((int64_t)hi << 32) + lo;
+#else /* __i386 */
+		pentiumTscGet64(&timestamp);
+#endif
+		/* Convert to a resolution of 1 Microsecond.
+		 * (t/f)*c : rounding errors on integer
+		 * (t*c)/f : overflow
+		 * (t/f)*c + ((t%f)*c)/f : integer error compensated.
+		 * Overflow save while f*c has no overflow
+		 * With 64Bit and c=1M: until f=16THz 
+		 */
+		return ( timestamp / frequency ) * UsecPerSec +
+				( (timestamp % frequency) * UsecPerSec ) / frequency;
+	}
 #else
 	{
 	    std::cerr << "CPU clock not implemented for this architecture" << std::endl;
@@ -51,10 +122,24 @@
 	}
 #endif	
     } else {
-	struct timeval tv;
-	
-	gettimeofday(&tv, NULL);	
-	return (usec_t) (tv.tv_sec * UsecPerSec + tv.tv_usec);
+#ifdef LOG4CPP_HAVE_GETTIMEOFDAY
+    	struct timeval tv;
+    	
+    	gettimeofday(&tv, NULL);
+    	return (usec_t) (tv.tv_sec * UsecPerSec + tv.tv_usec);
+#else
+		/* Anyway timezones are undefined by POSIX gettimeofday and not used above.
+		 * Use Posix clock_gettime(CLOCK_REALTIME,struct timespec *) instead.
+		 * gettimeofday timeval: tv_usec Microseconds
+		 * clock_gettime timespec: tv_nsec Nanoseconds. Scale down!
+		 * UsecPerSec propagates to 64Bit, so no overflow ...+ (ts.tv_nsec * UsecPerSec)/1000000000
+		 * But anyway hardcoded immediately above ...+ts.tv_nsec/1000
+		 */
+		struct timespec ts;
+		
+		clock_gettime(CLOCK_REALTIME,&ts);
+		return (usec_t) (ts.tv_sec * UsecPerSec + (ts.tv_nsec * UsecPerSec)/1000000000 );
+#endif		
     }
 }
 
diff -Naur log4cpp-1.0/tests/Clock.hh log4cpp-1.0+/tests/Clock.hh
--- log4cpp-1.0/tests/Clock.hh	2002-09-15 22:40:50.000000000 +0000
+++ log4cpp-1.0+/tests/Clock.hh	2011-02-11 17:14:06.988825000 +0000
@@ -6,6 +6,8 @@
 #ifndef __CLOCK_H
 #define __CLOCK_H
 
+#include <log4cpp/Portability.hh>
+
 #ifdef LOG4CPP_HAVE_STDINT_H
 #include <stdint.h>
 #endif // LOG4CPP_HAVE_STDINT_H
@@ -13,6 +15,16 @@
 #ifdef __osf__
     typedef long usec_t;    /* number of microseconds since 1970/01/01 */
 #   define INT64_CONSTANT(val)  (val##L)
+#elif defined(__GNUC__)
+    /* __extension__ should avoid GNU -pedantic warning: use of C99 long long integer constant
+     * Not working, see http://gcc.gnu.org/bugzilla/show_bug.cgi?id=7263
+     * Also suggested workaround of using unsigned with "ULL" does not work with e.g. GNU 4.1.2
+     * #   define INT64_CONSTANT(val)  ((int64_t)(uint64_t)(__extension__ val##ULL))
+     * For now just typecast unspecified scalar literal to 64 Bit. OK on numbers which fit in 31/32 bit.
+     * Compiler error on numbers which do not fit. Need to express differently in sourcecode.
+     */
+    typedef int64_t usec_t;
+#   define INT64_CONSTANT(val)  ((int64_t)val)
 #else
     typedef int64_t usec_t;
 #   define INT64_CONSTANT(val)  (val##LL)
diff -Naur log4cpp-1.0/tests/testbench.cpp log4cpp-1.0+/tests/testbench.cpp
--- log4cpp-1.0/tests/testbench.cpp	2007-08-29 08:52:40.000000000 +0000
+++ log4cpp-1.0+/tests/testbench.cpp	2011-02-11 17:14:06.991812000 +0000
@@ -1,3 +1,15 @@
+#include "PortabilityImpl.hh"
+
+#ifdef LOG4CPP_HAVE_UNISTD_H
+#include <unistd.h> /* For dup() Linux or VxWorks application process */
+#endif
+#ifdef LOG4CPP_HAVE_IO_H
+#    include <io.h> /* For dup() Windows */
+#endif
+#if defined(__vxworks) && !defined(__RTP__)
+ # include <ioLib.h>  /* For dup() missing in unistd.h of VxWorks kernel process */
+#endif
+
 #include <cstdlib>
 #include <cstring>
 #include <cstdio>
@@ -14,6 +26,7 @@
 
 
 // -----------------------------------------------------------------------------
+LOG4CPP_MAIN_DECL(testbench)
 int main(int argc, char* argv[])
 {
     int    count  = argc > 1 ? std::atoi(argv[1]) : 100;
@@ -26,8 +39,21 @@
     log4cpp::Category&	root	 = log4cpp::Category::getRoot();
     root.setPriority(log4cpp::Priority::ERROR);    
 
+    /* Compare with FileAppender usage
+     * in SimpleConfigurator::configure() and BasicConfigurator::configure()
+     * Ownership of the already opened file descriptor gets transfered to the FileAppender
+     * object which is responsible to close on Destruction.
+     * Closing stdout/stderr would prevent using stdout/stderr later in the application.
+     * If process lives longer as the application, this breaks also other applications which
+     * are running in the same process, e.g. if shell and application are loaded into a
+     * VxWorks kernel process.
+     * Therefore with dup() transfer an additional file descriptor to the same file,
+     * instead of the file descriptor itself.
+     * Note: OstreamAppender behaves different - ownership of stream remains at the caller
+     *   and gets not closed on Destruction.
+     */
     log4cpp::OstreamAppender ostreamAppender("cerr", &std::cerr);
-    log4cpp::FileAppender fileAppender("stderr", fileno(stderr));
+    log4cpp::FileAppender fileAppender("stderr", dup(fileno(stderr)));
     ostreamAppender.setLayout(new log4cpp::BasicLayout());
     fileAppender.setLayout(new log4cpp::BasicLayout());
 
diff -Naur log4cpp-1.0/tests/testCategory.cpp log4cpp-1.0+/tests/testCategory.cpp
--- log4cpp-1.0/tests/testCategory.cpp	2007-08-28 07:54:12.000000000 +0000
+++ log4cpp-1.0+/tests/testCategory.cpp	2011-02-11 17:14:06.993812000 +0000
@@ -134,7 +134,7 @@
 
 } /* end testMultiAppenders() */
 
-
+LOG4CPP_MAIN_DECL(testCategory)
 int main(int argc, char** argv) {    
 
     testMultiAppenders();
@@ -205,3 +205,4 @@
 
     return 0;
 }
+
diff -Naur log4cpp-1.0/tests/testConfig.cpp log4cpp-1.0+/tests/testConfig.cpp
--- log4cpp-1.0/tests/testConfig.cpp	2007-08-28 07:54:12.000000000 +0000
+++ log4cpp-1.0+/tests/testConfig.cpp	2011-02-11 17:14:06.995815000 +0000
@@ -24,7 +24,10 @@
 
 #include <log4cpp/SimpleConfigurator.hh>
 
-double calcPi()
+/* static to avoid conflict when testConfig and testPropertyConfig
+ * are loaded into the same process e.g. in VxWorks
+ */
+static double calcPi()
 {
     double denominator = 3.0;
     double retVal = 4.0;
@@ -39,6 +42,7 @@
     return retVal;
 }
 
+LOG4CPP_MAIN_DECL(testConfig)
 int main(int argc, char* argv[])
 {
     try {
diff -Naur log4cpp-1.0/tests/testErrorCollision.cpp log4cpp-1.0+/tests/testErrorCollision.cpp
--- log4cpp-1.0/tests/testErrorCollision.cpp	2001-06-01 17:56:59.000000000 +0000
+++ log4cpp-1.0+/tests/testErrorCollision.cpp	2011-02-11 17:14:06.997812000 +0000
@@ -1,9 +1,40 @@
+/* If the platform has the ERROR problem, the full Portability.hh
+ * with double inclusion protection is needed before faking
+ * the ERROR definition, to prevent silent
+ * redefinition of ERROR by later indirectly included system internal
+ * headers. Implicite include of Portability.hh by Priority.hh
+ * after faking ERROR is not enough.
+ */
+#include <log4cpp/Portability.hh>
+#ifndef LOG4CPP_FIX_ERROR_COLLISION
+/* For consistency test,
+ * if, and only if current platform does not have the problem, simulate it.
+ */
 #define ERROR 666
 #define LOG4CPP_FIX_ERROR_COLLISION 1
+#endif
+
+/* Record the value as defined by the platform headers */
+const int ERROR_platform = ERROR;
 
 #include <log4cpp/Priority.hh>
 #include <assert.h>
+#include <iostream>
+
+/* Trying to define in non system header must produce a compiler warning
+ */
+//#define ERROR 777
 
+/* Make sure that Macro fix in Priority.hh did
+ * not change the value, neither for the system ERROR
+ * nor for the log4cpp ERROR.
+ * If the ERROR Macro got redefined to a numeric value,
+ * a syntax error results below. This is intentional.
+ */
+LOG4CPP_MAIN_DECL(testErrorCollision)
 int main(int argc, char** argv) {
-    assert(ERROR == 666);
+    assert(ERROR == ERROR_platform);
+    assert(log4cpp::Priority::ERROR == 300);
+    std::cout << "platform ERROR = " << ERROR << std::endl;
+    return 0;
 }
diff -Naur log4cpp-1.0/tests/testFilter.cpp log4cpp-1.0+/tests/testFilter.cpp
--- log4cpp-1.0/tests/testFilter.cpp	2002-08-12 21:21:52.000000000 +0000
+++ log4cpp-1.0+/tests/testFilter.cpp	2011-02-11 17:14:07.000812000 +0000
@@ -37,6 +37,7 @@
     };
 };
 
+LOG4CPP_MAIN_DECL(testFilter)
 int main(int argc, char** argv) {
     TestFilter filter;
 
diff -Naur log4cpp-1.0/tests/testFixedContextCategory.cpp log4cpp-1.0+/tests/testFixedContextCategory.cpp
--- log4cpp-1.0/tests/testFixedContextCategory.cpp	2007-08-28 07:54:12.000000000 +0000
+++ log4cpp-1.0+/tests/testFixedContextCategory.cpp	2011-02-11 17:14:07.001819000 +0000
@@ -8,6 +8,7 @@
 #include "log4cpp/Priority.hh"
 #include "log4cpp/NDC.hh"
 
+LOG4CPP_MAIN_DECL(testFixedContextCategory)
 int main(int argc, char** argv) {    
     log4cpp::Appender* appender = 
         new log4cpp::OstreamAppender("default", &std::cout);
diff -Naur log4cpp-1.0/tests/testmain.cpp log4cpp-1.0+/tests/testmain.cpp
--- log4cpp-1.0/tests/testmain.cpp	2007-08-28 07:54:12.000000000 +0000
+++ log4cpp-1.0+/tests/testmain.cpp	2011-02-11 17:14:07.004812000 +0000
@@ -16,6 +16,7 @@
 #include "log4cpp/Priority.hh"
 #include "log4cpp/NDC.hh"
 
+LOG4CPP_MAIN_DECL(testmain)
 int main(int argc, char** argv) {
 	log4cpp::Appender* appender;
 #ifdef LOG4CPP_HAVE_SYSLOG
@@ -28,10 +29,16 @@
 	syslogAppender = new log4cpp::OstreamAppender("syslogdummy", &std::cout);
 #endif
 
-	if (argc < 2) {
+	int count = 10000;
+	int argfn = 1;
+	if (argc >= 3 && !std::strcmp(argv[1],"-n")) {
+		count = std::atoi(argv[2]);
+		argfn = 3;
+	}
+	if (argc <= argfn ) {
 		appender = new log4cpp::OstreamAppender("default", &std::cout);
 	} else {
-		appender = new log4cpp::FileAppender("default", argv[1]);
+		appender = new log4cpp::FileAppender("default", argv[argfn]);
 	}
 
 	syslogAppender->setLayout(new log4cpp::BasicLayout());
@@ -78,7 +85,7 @@
              << log4cpp::eol << " warn4";
 
 	{
-		for(int i = 0; i < 10000; i++) {
+		for(int i = 0; i < count; i++) {
 			char ndc2[20];
 			sprintf(ndc2, "i=%d", i);
 			log4cpp::NDC::push(ndc2);
diff -Naur log4cpp-1.0/tests/testNDC.cpp log4cpp-1.0+/tests/testNDC.cpp
--- log4cpp-1.0/tests/testNDC.cpp	2002-06-18 11:31:53.000000000 +0000
+++ log4cpp-1.0+/tests/testNDC.cpp	2011-02-11 17:14:07.006812000 +0000
@@ -3,6 +3,7 @@
 
 using namespace log4cpp;
 
+LOG4CPP_MAIN_DECL(testNDC)
 int main(int argc, char** argv) {
     std::cout << "1. empty NDC: " << NDC::get() << std::endl;
 
diff -Naur log4cpp-1.0/tests/testNTEventLog.cpp log4cpp-1.0+/tests/testNTEventLog.cpp
--- log4cpp-1.0/tests/testNTEventLog.cpp	2002-06-17 07:43:43.000000000 +0000
+++ log4cpp-1.0+/tests/testNTEventLog.cpp	2011-02-11 17:14:07.008812000 +0000
@@ -17,6 +17,7 @@
 #include "log4cpp/NTEventLogAppender.hh"
 #include "log4cpp/Priority.hh"
 
+LOG4CPP_MAIN_DECL(testNTEventLog)
 int main(int argc, char* argv[])
 {
     log4cpp::Appender* appender = 
diff -Naur log4cpp-1.0/tests/testPattern.cpp log4cpp-1.0+/tests/testPattern.cpp
--- log4cpp-1.0/tests/testPattern.cpp	2003-05-09 23:24:31.000000000 +0000
+++ log4cpp-1.0+/tests/testPattern.cpp	2011-02-11 17:14:07.010814000 +0000
@@ -18,6 +18,7 @@
     }	
 }                                                                              
 
+LOG4CPP_MAIN_DECL(testPattern)
 int main(int argc, char* argv[])
 {
     log4cpp::BasicConfigurator::configure();
diff -Naur log4cpp-1.0/tests/testPriority.cpp log4cpp-1.0+/tests/testPriority.cpp
--- log4cpp-1.0/tests/testPriority.cpp	2002-03-22 12:44:28.000000000 +0000
+++ log4cpp-1.0+/tests/testPriority.cpp	2011-02-11 17:14:07.012814000 +0000
@@ -3,6 +3,7 @@
 
 using namespace log4cpp;
 
+LOG4CPP_MAIN_DECL(testPriority)
 int main(int argc, char** argv) {
     
     std::cout << "priority debug(700): " << Priority::getPriorityName(700) << std::endl;
diff -Naur log4cpp-1.0/tests/testProperties.cpp log4cpp-1.0+/tests/testProperties.cpp
--- log4cpp-1.0/tests/testProperties.cpp	2002-08-15 23:17:31.000000000 +0000
+++ log4cpp-1.0+/tests/testProperties.cpp	2011-02-11 17:14:07.014817000 +0000
@@ -2,6 +2,7 @@
 #include <iostream>
 #include <fstream>
 
+LOG4CPP_MAIN_DECL(testProperties)
 int main(int argc, char** argv) {
     log4cpp::Properties properties;
     std::string inFile = (argc > 1) ? argv[1] : "log4cpp.properties";  
@@ -9,5 +10,6 @@
 
     properties.load(in);
     properties.save(std::cout);
+    return 0;
 }
 
diff -Naur log4cpp-1.0/tests/testPropertyConfig.cpp log4cpp-1.0+/tests/testPropertyConfig.cpp
--- log4cpp-1.0/tests/testPropertyConfig.cpp	2007-08-28 07:54:12.000000000 +0000
+++ log4cpp-1.0+/tests/testPropertyConfig.cpp	2011-02-11 17:14:07.016815000 +0000
@@ -24,7 +24,10 @@
 
 #include <log4cpp/PropertyConfigurator.hh>
 
-double calcPi()
+/* static to avoid conflict when testConfig and testPropertyConfig
+ * are loaded into the same process e.g. in VxWorks
+ */
+static double calcPi()
 {
     double denominator = 3.0;
     double retVal = 4.0;
@@ -39,6 +42,7 @@
     return retVal;
 }
 
+LOG4CPP_MAIN_DECL(testPropertyConfig)
 int main(int argc, char* argv[])
 {
     try {
