#! /bin/bash
#*******************************************************************************
# E.S.O. - ALMA project
#
# "@(#) $Id$"
#
# who        when        what
# --------   ----------  ----------------------------------------------
# agrimstrup 2007-07-10  created
#

#************************************************************************
#   NAME
#
#   SYNOPSIS
#
#   DESCRIPTION
#
#   FILES
#
#   ENVIRONMENT
#
#   RETURN VALUES
#
#   CAUTIONS
#
#   EXAMPLES
#
#   SEE ALSO
#
#   BUGS
#
#------------------------------------------------------------------------
#

#
# Install Python Modules
#
#set -x
#export PYTHON_ROOT=/alma/$ALMASW_RELEASE/Python

# Load functions
. standardUtilities
#
# Fetch operating system and release version
#
os_discovery

LOG=buildPyModules.log
CWD=`pwd`
#
exec > $LOG 2>&1

date

if [ ! -d $PYTHON_ROOT ]
then
  echo "$PYTHON_ROOT not found, cannot continue..."
  exit 1
fi

PYTHON_INTR=$PYTHON_ROOT/bin/python

echo installing Python Modules

echo $SEPARATOR
if [ ${OS} = "LINUX" ] 
then
	echo "Installing on $DISTRO $OS version $REL"
else
	echo "Installing on $OS version $REL"
fi

if [     ${DISTRO}-${REL} != "SOLARIS-5.8"       \
     -a  ${DISTRO}-${REL} != "RHLX-7.2"           \
     -a  ${DISTRO}-${REL} != "RHLX-7.3"           \
     -a  ${DISTRO}-${REL} != "RHLX-9"           \
     -a  ${DISTRO}-${REL} != "RHEL-4"           \
     -a  ${DISTRO}-${REL} != "RHEL-5"           \
     -a  ${DISTRO}-${REL} != "RHEL-5.3"           \
     -a  ${DISTRO}-${REL} != "SL-4.1"           \
     -a  ${DISTRO}-${REL} != "SL-5.3"           \
   ]
then
    echo "OS not supported. Proceeding as for Linux RH 9"
    echo ""
fi

#
# Python - Python-2.6.5
#
# Notes: See README for help
#
cd ../PRODUCTS

PY_VERSION=2.7

if [ ! -e ../PRODUCTS/setuptools-17.0.tar.gz ]
then
  echo Error: setuptools sources are missing
else
  echo "== Building setuptools"
  tar -zxf setuptools-17.0.tar.gz
  pushd setuptools-17.0
  $PYTHON_INTR setup.py install
  popd
fi

if [ ! -e ../PRODUCTS/gnuplot-py-1.8.tar.gz ]
then
  echo Error: GnuPlot Py sources are missing
else
  echo "== Building GnuPlot Py"
  tar -zxf gnuplot-py-1.8.tar.gz
  pushd gnuplot-py-1.8
  $PYTHON_INTR setup.py install
  popd
fi

if [ ! -e ../PRODUCTS/pexpect-2.3.tar.gz ]
then
  echo Error: pexpect sources are missing
else
  echo "== Building pexpect"
  tar -zxf pexpect-2.3.tar.gz
  pushd pexpect-2.3
  $PYTHON_INTR setup.py install 
  popd
fi

if [ ! -e ../PRODUCTS/mock-0.6.0.zip ]
then
  echo Error: Python Mock sources are missing
else
  echo "== Installing Python Mock Objects"
  unzip -oj mock-0.6.0.zip mock-0.6.0/mock.py mock-0.6.0/testcase.py mock-0.6.0/testutils.py -d $PYTHON_ROOT/lib/python$PY_VERSION/site-packages/
fi

if [ ! -e ../PRODUCTS/nose-0.11.3.tar.gz ]
then
  echo Error: nose sources are missing
else
  echo "== Installing nose"
  tar -zxf nose-0.11.3.tar.gz
  pushd nose-0.11.3
  $PYTHON_INTR setup.py install 
  popd
fi

cd $CWD
echo Python Module installation done!
date

