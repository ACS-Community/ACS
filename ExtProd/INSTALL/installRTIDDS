#! /bin/bash

echo "Please read RTI Software License Agreement carefully!"
which acroread 2&>1 /dev/null
if [ $? == 0 ]
then
    acroread ../PROPRIETARY/RTIDDS/RTISoftwareLicenseAgreement20101217.pdf
else
    less -E ../PROPRIETARY/RTIDDS/RTISoftwareLicenseAgreement20101217.txt 
fi

echo "-------------------------------------------------------------------------------"
echo "Press Y or y if you have read and you agree with RTI Software License Agreement" 

read -n1 AGREE
if [ $AGREE != y -a $AGREE != Y ]
then
    echo ""
    echo "installation of RTI DDS terminated !"
    exit 1
fi

echo ""

ARCH=`uname -m`
if [ $ARCH == x64_64 ]
then
    HOST_TAR=rtidds45d-host-x64Linux.tar.gz.gpg
    TARGET_TAR=rtidds45d-target-x64Linux2.6gcc4.1.2.tar.gz.gpg
else
    if [ $ARCH == i386 -o $ARCH == i686 ]
    then
	HOST_TAR=rtidds45d-host-i86Linux.tar.gz.gpg
	TARGET_TAR=rtidds45d-target-i86Linux2.6gcc4.1.2.tar.gz.gpg
    else
	echo "ERROR: not supported platform: $ARCH"
	exit 2
    fi
fi

if [ -d $ALMASW_ROOTDIR/$ALMASW_RELEASE/RTI ]
then
  echo $ALMASW_ROOTDIR/$ALMASW_RELEASE/RTI directory exists already. I clean it up.
  rm -rf $ALMASW_ROOTDIR/$ALMASW_RELEASE/RTI
fi
mkdir $ALMASW_ROOTDIR/$ALMASW_RELEASE/RTI
if [ $? != 0 ]
then
    echo "ERROR: Cold not create: " $ALMASW_ROOTDIR/$ALMASW_RELEASE/RTI
    exit 3
fi

TMP_DIR=$PWD
cd $ALMASW_ROOTDIR/$ALMASW_RELEASE/RTI

echo "Please give the passphrase (will not bee seen on the screen) for $HOST_TAR & $TARGET_TAR: "
read -sp ">" PASS

gpg -d --passphrase $PASS $TMP_DIR/../PROPRIETARY/RTIDDS/$HOST_TAR | tar xvz
if [ $? != 0 ]
then
    cd $TMP_DIR
    echo "ERROR: failed to decrypte/unpack $HOST_TAR "
    exit 4
fi

gpg -d --passphrase $PASS $TMP_DIR/../PROPRIETARY/RTIDDS/$TARGET_TAR | tar xvz
if [ $? != 0 ]
then
    cd $TMP_DIR
    echo "ERROR: failed to decrypte/unpack $TARGET_TAR "
    exit 5
fi
cd $TMP_DIR
echo "Installation of RTI DDS completed."
echo "=================================="